#!/bin/bash

prefix=@prefix@
pkgdatadir=@datarootdir@/@PACKAGE@
PYTHON=@PYTHON@

if [ $# -lt 1 ]; then
  echo "Usage: $0 disk_image" >&2
  exit 1
fi

imagefile=$1
imagefilebn=$(basename "$imagefile")
outdir="${imagefilebn%.*}"

echo "fsnview: Debug: outdir: $outdir" >&2

"$pkgdatadir/nversion.mk" \
  FIWALK_MAYBE_ALLOC_ONLY="-O" \
  PKGDATADIR="$pkgdatadir" \
  PREFIX="$prefix" \
  PYTHON="$PYTHON" \
  IMAGE="$imagefile"

# Run report
echo "Exit statuses of all the DFXML-generating programs (should be 0's):"
grep '^' *.status.log | cat
echo ""
echo "Review these files for between-tool differences:"
ls diffs*.txt
echo ""
echo "Review these files for file system timelines according to each tool:"
ls mactimeline*.txt
