#!/bin/bash

disk_image="$1"
output_root="$2"

do_xtaf=0

if [ true ]; then
  do_xtaf=1
fi

#Execute analysis scripts idempotently when possible
if [ $do_xtaf -eq 1 ]; then
  if [ ! -r "${output_root}/dfxml/analyze_with_uxtaf.sh.done.log" ]; then
    rm -rf "${output_root}/dfxml/analyze_with_uxtaf.sh*"
    "${pkgdatadir}/log_and_run_script.sh" "${pkgdatadir}/uxtaf_all_parts.sh" "$disk_image" "${output_root}/dfxml/analyze_with_uxtaf.sh"
  fi

  if [ ! -r "${output_root}/dfxml/analyze_with_fiwalk.sh.done.log" ]; then
    rm -rf "${output_root}/dfxml/analyze_with_fiwalk.sh*"
    "${pkgdatadir}/log_and_run_script.sh" "${pkgdatadir}/analyze_with_fiwalk.sh" "$disk_image" "${output_root}/dfxml/analyze_with_fiwalk.sh"
  fi

  if [ ! -r "${output_root}/dfxml/analyze_with_py360.sh.done.log" ]; then
    rm -rf "${output_root}/dfxml/analyze_with_py360.sh*"
    "${pkgdatadir}/log_and_run_script.sh" "${pkgdatadir}/analyze_with_py360.sh" "$disk_image" "${output_root}/dfxml/analyze_with_py360.sh"
  fi
fi
